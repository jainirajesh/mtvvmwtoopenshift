---
- name: Check TCP port 22 reachability
  wait_for:
    host: "{{ current_ip }}"
    port: 22
    timeout: 5
    state: started
  register: port22_result
  ignore_errors: true

- name: Check TCP port 3389 reachability
  wait_for:
    host: "{{ current_ip }}"
    port: 3389
    timeout: 5
    state: started
  register: port3389_result
  ignore_errors: true

- name: Append current IP's results to ping_results
  set_fact:
    ping_results: "{{ ping_results + [ {
      'ip': current_ip,
      'port22_status': (port22_result is succeeded) | ternary('✅', '❌'),
      'port3389_status': (port3389_result is succeeded) | ternary('✅', '❌')
    } ] }}"

- name: Create Migration Plan without preserving IPs
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: forklift.konveyor.io/v1beta1
      kind: Plan
      metadata:
        name: "{{ plan_group.key }}"
        namespace: "{{ mtv_namespace }}"
      spec:
        provider:
          source:
            apiVersion: forklift.konveyor.io/v1beta1
            kind: Provider
            name: "{{ source_provider_name }}"
            namespace: "{{ mtv_namespace }}"
            uid: "{{ source_provider_uid }}"
          destination:
            apiVersion: forklift.konveyor.io/v1beta1
            kind: Provider
            name: "{{ destination_provider_name }}"
            namespace: "{{ mtv_namespace }}"
            uid: "{{ destination_provider_uid }}"
        map:
          network:
            apiVersion: forklift.konveyor.io/v1beta1
            kind: NetworkMap
            name: "netmap-{{ plan_group.key | lower }}"
            namespace: "{{ mtv_namespace }}"
          storage:
            apiVersion: forklift.konveyor.io/v1beta1
            kind: StorageMap
            name: "storagemap-{{ plan_group.key | lower }}"
            namespace: "{{ mtv_namespace }}"
        targetNamespace: "{{ plan_group.value.rows[0]['Target Namespace'] }}"
        pvcNameTemplateUseGenerateName: true
        preserveStaticIPs: false
        migrateSharedDisks: true
        warm: "{{ plan_group.value.is_warm }}"
        vms: "{{ plan_group.value.vms }}"
